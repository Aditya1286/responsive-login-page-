<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteShare - Collaborative Notes App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --secondary: #10b981;
            --secondary-hover: #059669;
            --delete: #ef4444;
            --delete-hover: #dc2626;
            --share: #3b82f6;
            --share-hover: #2563eb;
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --text-light: #9ca3af;
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f3f4f6;
            --border: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.15);
            --transition-duration: 0.3s;
        }

        .dark {
            --primary: #818cf8;
            --primary-hover: #6366f1;
            --secondary: #34d399;
            --secondary-hover: #10b981;
            --delete: #f87171;
            --delete-hover: #ef4444;
            --share: #60a5fa;
            --share-hover: #3b82f6;
            --text-primary: #f9fafb;
            --text-secondary: #e5e7eb;
            --text-light: #9ca3af;
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-tertiary: #374151;
            --border: #374151;
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-dark: rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color var(--transition-duration), color var(--transition-duration), border-color var(--transition-duration), box-shadow var(--transition-duration);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            font-size: 1.875rem;
            font-weight: 700;
        }

        .logo-icon {
            color: var(--primary);
        }

        .user-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            border: none;
            outline: none;
            margin-right: 0.5rem;
        }

        .theme-toggle:hover {
            background-color: var(--border);
        }

        .user-name {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            outline: none;
            transition: background-color 0.2s, transform 0.2s;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-hover);
        }

        .btn-delete {
            background-color: var(--delete);
            color: white;
        }

        .btn-delete:hover {
            background-color: var(--delete-hover);
        }

        .btn-share {
            background-color: var(--share);
            color: white;
        }

        .btn-share:hover {
            background-color: var(--share-hover);
        }

        .tagline {
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (min-width: 768px) {
            .grid {
                grid-template-columns: 1fr 2fr;
            }
        }

        .panel {
            background-color: var(--bg-secondary);
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px var(--shadow);
            padding: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
        }

        .panel:hover {
            box-shadow: 0 10px 15px var(--shadow-dark);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .panel-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .notes-container {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
        }

        .notes-container::-webkit-scrollbar {
            width: 6px;
        }

        .notes-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .notes-container::-webkit-scrollbar-thumb {
            background-color: var(--border);
            border-radius: 20px;
        }

        .note-item {
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 0.75rem;
            background-color: var(--bg-tertiary);
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            border-left: 3px solid transparent;
        }

        .note-item:hover {
            transform: translateY(-2px);
            background-color: var(--bg-tertiary);
            border-left-color: var(--primary);
        }

        .note-item.active {
            border-left-color: var(--primary);
            background-color: var(--bg-tertiary);
        }

        .note-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .note-preview {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .note-meta {
            color: var(--text-light);
            font-size: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }

        .form-control {
            margin-bottom: 1rem;
        }

        .input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .textarea {
            min-height: 280px;
            resize: vertical;
        }

        .editor-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .action-group {
            display: flex;
            gap: 0.5rem;
        }

        .share-container {
            display: flex;
            gap: 0.5rem;
            max-width: 100%;
        }

        .share-input {
            flex-grow: 1;
            min-width: 0;
        }

        .collaborators {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .collaborators-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .collaborators-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .collaborator-tag {
            background-color: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .shared-notes {
            margin-top: 2rem;
        }

        .shared-notes-grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        .shared-note-card {
            background-color: var(--bg-secondary);
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px var(--shadow);
            padding: 1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border-top: 4px solid var(--share);
        }

        .shared-note-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px var(--shadow-dark);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--bg-secondary);
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px var(--shadow-dark);
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .modal-overlay.show .modal {
            transform: translateY(0);
        }

        .modal-header {
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-success {
            border-left: 4px solid var(--secondary);
        }

        .toast-error {
            border-left: 4px solid var(--delete);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(99, 102, 241, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
            }
        }

        .editor-placeholder {
            height: 380px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
            color: var(--text-light);
            text-align: center;
            padding: 2rem;
        }

        .editor-placeholder-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary);
            opacity: 0.5;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            position: relative;
            width: 64px;
            height: 64px;
        }

        .loading div {
            position: absolute;
            top: 27px;
            width: 11px;
            height: 11px;
            border-radius: 50%;
            background: var(--primary);
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }

        .loading div:nth-child(1) {
            left: 6px;
            animation: loading1 0.6s infinite;
        }

        .loading div:nth-child(2) {
            left: 6px;
            animation: loading2 0.6s infinite;
        }

        .loading div:nth-child(3) {
            left: 26px;
            animation: loading2 0.6s infinite;
        }

        .loading div:nth-child(4) {
            left: 45px;
            animation: loading3 0.6s infinite;
        }

        @keyframes loading1 {
            0% {
                transform: scale(0);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes loading3 {
            0% {
                transform: scale(1);
            }

            100% {
                transform: scale(0);
            }
        }

        @keyframes loading2 {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(19px, 0);
            }
        }

        @media (max-width: 640px) {
            .editor-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .action-group {
                width: 100%;
                justify-content: space-between;
            }

            .share-container {
                width: 100%;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-container {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo animate__animated animate__fadeIn">
                    <span class="logo-icon"><i class="fas fa-book"></i></span>
                    NoteShare
                </div>
                <div class="user-container">
                    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-avatar" id="user-avatar"></div>
                    <span id="user-name" class="user-name">Guest User</span>
                    <button id="change-name-btn" class="btn btn-primary">
                        <i class="fas fa-user-edit"></i> Change Name
                    </button>
                </div>
            </div>
            <p class="tagline animate__animated animate__fadeIn animate__delay-1s">Create, share, and collaborate on
                notes in real-time</p>
        </header>

        <!-- Main content -->
        <div class="grid animate__animated animate__fadeInUp animate__delay-1s">
            <!-- Notes List Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">My Notes</h2>
                    <button id="add-note-btn" class="btn btn-secondary">
                        <i class="fas fa-plus"></i> New Note
                    </button>
                </div>
                <div id="notes-list" class="notes-container">
                    <!-- Notes will be dynamically added here -->
                    <div class="empty-state">
                        <div class="loading">
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Editor Panel -->
            <div class="panel">
                <div id="editor-container">
                    <div class="form-control">
                        <input id="note-title" type="text" placeholder="Note Title" class="input">
                    </div>
                    <div class="form-control">
                        <textarea id="note-content" placeholder="Start typing your note here..."
                            class="input textarea"></textarea>
                    </div>
                    <div class="editor-actions">
                        <div class="action-group">
                            <button id="save-note-btn" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Note
                            </button>
                            <button id="delete-note-btn" class="btn btn-delete">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </div>
                        <div class="share-container">
                            <input id="share-link" type="text" readonly class="input share-input"
                                placeholder="Share link will appear here">
                            <button id="share-note-btn" class="btn btn-share">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                        </div>
                    </div>
                    <div id="collaborators" class="collaborators hidden">
                        <h3 class="collaborators-title">Collaborators:</h3>
                        <div id="collaborators-list" class="collaborators-list">
                            <!-- Collaborators will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Editor placeholder (shows when no note is selected) -->
                <div id="editor-placeholder" class="editor-placeholder">
                    <div class="editor-placeholder-icon">
                        <i class="far fa-sticky-note"></i>
                    </div>
                    <h3>No note selected</h3>
                    <p>Select a note from the list or create a new one to start editing</p>
                </div>
            </div>
        </div>

        <!-- Shared Notes Panel -->
        <div class="shared-notes panel animate__animated animate__fadeInUp animate__delay-2s">
            <div class="panel-header">
                <h2 class="panel-title">Shared With Me</h2>
            </div>
            <div id="shared-notes-list" class="shared-notes-grid">
                <!-- Shared notes will be dynamically added here -->
                <div class="empty-state">
                    <div class="loading">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="name-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Change Your Name</h3>
            </div>
            <div class="modal-body">
                <input id="name-input" type="text" placeholder="Enter your name" class="input">
            </div>
            <div class="modal-footer">
                <button id="cancel-name-btn" class="btn">Cancel</button>
                <button id="save-name-btn" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <div id="share-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Share Note</h3>
            </div>
            <div class="modal-body">
                <p class="mb-2 text-sm text-gray-600">Share this link with others to collaborate:</p>
                <div class="form-control">
                    <input id="modal-share-link" type="text" readonly class="input">
                </div>
            </div>
            <div class="modal-footer">
                <button id="copy-link-btn" class="btn btn-primary">
                    <i class="fas fa-copy"></i> Copy Link
                </button>
                <button id="close-share-modal-btn" class="btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast" class="toast">
        <i id="toast-icon" class="fas fa-check-circle"></i>
        <span id="toast-message">Notification message</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // App state
            let currentUser = localStorage.getItem('userName') || 'Guest User';
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            let sharedNotes = JSON.parse(localStorage.getItem('sharedNotes')) || [];
            let currentNoteId = null;
            let isDarkMode = localStorage.getItem('darkMode') === 'true';

            // DOM elements
            const userNameEl = document.getElementById('user-name');
            const userAvatarEl = document.getElementById('user-avatar');
            const notesListEl = document.getElementById('notes-list');
            const sharedNotesListEl = document.getElementById('shared-notes-list');
            const noteTitleEl = document.getElementById('note-title');
            const noteContentEl = document.getElementById('note-content');
            const collaboratorsEl = document.getElementById('collaborators');
            const collaboratorsListEl = document.getElementById('collaborators-list');
            const shareLinkEl = document.getElementById('share-link');
            const modalShareLinkEl = document.getElementById('modal-share-link');
            const editorContainerEl = document.getElementById('editor-container');
            const editorPlaceholderEl = document.getElementById('editor-placeholder');
            const themeToggleEl = document.getElementById('theme-toggle');
            const toastEl = document.getElementById('toast');
            const toastIconEl = document.getElementById('toast-icon');
            const toastMessageEl = document.getElementById('toast-message');

            // Initialize theme
            if (isDarkMode) {
                document.body.classList.add('dark');
                themeToggleEl.innerHTML = '<i class="fas fa-sun"></i>';
            }

            // Toggle theme
            themeToggleEl.addEventListener('click', () => {
                isDarkMode = !isDarkMode;
                document.body.classList.toggle('dark');
                themeToggleEl.innerHTML = isDarkMode ?
                    '<i class="fas fa-sun"></i>' :
                    '<i class="fas fa-moon"></i>';
                localStorage.setItem('darkMode', isDarkMode);

                // Animation
                gsap.from('body', {
                    opacity: 0.8,
                    duration: 0.5
                });
            });

            // Show toast notification
            const showToast = (message, type = 'success') => {
                toastMessageEl.textContent = message;

                if (type === 'success') {
                    toastEl.className = 'toast toast-success';
                    toastIconEl.className = 'fas fa-check-circle';
                } else {
                    toastEl.className = 'toast toast-error';
                    toastIconEl.className = 'fas fa-exclamation-circle';
                }

                toastEl.classList.add('show');

                setTimeout(() => {
                    toastEl.classList.remove('show');
                }, 3000);
            };

            // Update user avatar
            const updateUserAvatar = () => {
                const initials = currentUser
                    .split(' ')
                    .map(name => name[0])
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);

                userAvatarEl.textContent = initials;
            };

            // Update displayed user name
            const updateUserName = () => {
                userNameEl.textContent = currentUser;
                localStorage.setItem('userName', currentUser);
                updateUserAvatar();
            };

            updateUserName();

            // Toggle editor/placeholder views
            const toggleEditorView = () => {
                if (currentNoteId) {
                    editorContainerEl.style.display = 'block';
                    editorPlaceholderEl.style.display = 'none';
                } else {
                    editorContainerEl.style.display = 'none';
                    editorPlaceholderEl.style.display = 'flex';
                }
            };

            toggleEditorView();

            // Render notes list with animation
            const renderNotesList = () => {
                notesListEl.innerHTML = '';

                if (notes.length === 0) {
                    const emptyEl = document.createElement('div');
                    emptyEl.className = 'empty-state';
                    emptyEl.innerHTML = `
            <i class="far fa-sticky-note fa-3x mb-4 text-gray-300"></i>
            <p>No notes yet. Create one!</p>
          `;
                    notesListEl.appendChild(emptyEl);
                    return;
                }

                // Sort notes by updated time (newest first)
                const sortedNotes = [...notes].sort((a, b) =>
                    new Date(b.updatedAt) - new Date(a.updatedAt)
                );

                sortedNotes.forEach((note, index) => {
                    const noteEl = document.createElement('div');
                    noteEl.className = 'note-item animate__animated animate__fadeIn';
                    noteEl.style.animationDelay = `${index * 0.05}s`;

                    if (currentNoteId === note.id) {
                        noteEl.classList.add('active');
                    }

                    noteEl.innerHTML = `
            <h3 class="note-title">${note.title || 'Untitled Note'}</h3>
            <p class="note-preview">${note.content.substring(0, 80)}${note.content.length > 80 ? '...' : ''}</p>
            <div class="note-meta">
              <span>${new Date(note.updatedAt).toLocaleString()}</span>
              ${note.shared ? '<span><i class="fas fa-share-alt text-blue-500"></i></span>' : ''}
            </div>
          `;

                    noteEl.addEventListener('click', () => {
                        document.querySelectorAll('.note-item').forEach(el => el.classList.remove('active'));
                        noteEl.classList.add('active');
                        loadNote(note.id);

                        // Animation
                        gsap.from(noteEl, {
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            duration: 0.5
                        });
                    });

                    notesListEl.appendChild(noteEl);
                });
            };

            // Render shared notes with animation
            const renderSharedNotes = () => {
                sharedNotesListEl.innerHTML = '';

                if (sharedNotes.length === 0) {
                    const emptyEl = document.createElement('div');
                    emptyEl.className = 'empty-state';
                    emptyEl.innerHTML = `
            <i class="fas fa-share-alt fa-3x mb-4 opacity-30"></i>
            <p>No shared notes yet</p>
          `;
                    sharedNotesListEl.appendChild(emptyEl);
                    return;
                }

                // Sort shared notes by updated time (newest first)
                const sortedSharedNotes = [...sharedNotes].sort((a, b) =>
                    new Date(b.updatedAt) - new Date(a.updatedAt)
                );

                sortedSharedNotes.forEach((note, index) => {
                    const noteEl = document.createElement('div');
                    noteEl.className = 'shared-note-card animate__animated animate__fadeIn';
                    noteEl.style.animationDelay = `${index * 0.05}s`;

                    noteEl.innerHTML = `
            <h3 class="note-title">${note.title || 'Untitled Note'}</h3>
            <p class="note-preview">${note.content.substring(0, 80)}${note.content.length > 80 ? '...' : ''}</p>
            <div class="note-meta">
              <span><i class="fas fa-user"></i> ${note.owner}</span>
              <span>${new Date(note.updatedAt).toLocaleString()}</span>
            </div>
          `;

                    noteEl.addEventListener('click', () => {
                        loadSharedNote(note.id);

                        // Animation
                        gsap.from(noteEl, {
                            y: -10,
                            duration: 0.3
                        });
                    });

                    sharedNotesListEl.appendChild(noteEl);
                });
            };

            // Load note into editor with animation
            const loadNote = (noteId) => {
                currentNoteId = noteId;
                const note = notes.find(n => n.id === noteId);

                if (note) {
                    noteTitleEl.value = note.title || '';
                    noteContentEl.value = note.content || '';

                    // Update share link
                    const shareLink = `${window.location.origin}${window.location.pathname}?share=${note.id}`;
                    shareLinkEl.value = note.shared ? shareLink : '';

                    // Show collaborators if any
                    if (note.collaborators && note.collaborators.length > 0) {
                        collaboratorsEl.classList.remove('hidden');
                        renderCollaborators(note.collaborators);
                    } else {
                        collaboratorsEl.classList.add('hidden');
                    }

                    // Animation
                    gsap.from([noteTitleEl, noteContentEl], {
                        opacity: 0,
                        y: 10,
                        stagger: 0.1,
                        duration: 0.3
                    });

                    toggleEditorView();
                }
            };

            // Load shared note with animation
            const loadSharedNote = (noteId) => {
                const sharedNote = sharedNotes.find(n => n.id === noteId);

                if (sharedNote) {
                    currentNoteId = noteId;
                    noteTitleEl.value = sharedNote.title || '';
                    noteContentEl.value = sharedNote.content || '';

                    // Update UI to show it's a shared note
                    collaboratorsEl.classList.remove('hidden');
                    collaboratorsListEl.innerHTML = `
            <span class="collaborator-tag">
              <i class="fas fa-user-crown"></i> Owner: ${sharedNote.owner}
            </span>
          `;

                    if (sharedNote.collaborators && sharedNote.collaborators.length > 0) {
                        renderCollaborators(sharedNote.collaborators);
                    }

                    // Animation
                    gsap.from([noteTitleEl, noteContentEl], {
                        opacity: 0,
                        y: 10,
                        stagger: 0.1,
                        duration: 0.3
                    });

                    toggleEditorView();
                }
            };

            // Render collaborators
            const renderCollaborators = (collaborators) => {
                // Keep owner tag if it exists
                const ownerTag = collaboratorsListEl.querySelector('.collaborator-tag:first-child');
                collaboratorsListEl.innerHTML = ownerTag ? ownerTag.outerHTML : '';

                collaborators.forEach(collab => {
                    const collabEl = document.createElement('span');
                    collabEl.className = 'collaborator-tag';
                    collabEl.innerHTML = `<i class="fas fa-user"></i> ${collab}`;
                    collaboratorsListEl.appendChild(collabEl);

                    // Animation
                    gsap.from(collabEl, {
                        scale: 0.8,
                        opacity: 0,
                        duration: 0.3
                    });
                });
            };

            // Create new note with animation
            const createNewNote = () => {
                const newNote = {
                    id: uuid.v4(),
                    title: '',
                    content: '',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    shared: false,
                    collaborators: []
                };

                notes.unshift(newNote);
                saveNotes();
                renderNotesList();
                loadNote(newNote.id);

                // Animation
                gsap.from('#editor-container', {
                    opacity: 0,
                    y: 20,
                    duration: 0.5
                });

                showToast('New note created successfully!');
            };

            // Save current note with animation
            const saveNote = () => {
                if (!currentNoteId) {
                    createNewNote();
                    currentNoteId = notes[0].id;
                    return;
                }

                const title = noteTitleEl.value;
                const content = noteContentEl.value;

                // Check if we're editing a personal note or a shared note
                const noteIndex = notes.findIndex(n => n.id === currentNoteId);

                if (noteIndex !== -1) {
                    // Updating personal note
                    notes[noteIndex].title = title;
                    notes[noteIndex].content = content;
                    notes[noteIndex].updatedAt = new Date().toISOString();
                    saveNotes();
                    renderNotesList();

                    // Animation
                    gsap.to('#save-note-btn', {
                        scale: 1.1,
                        duration: 0.2,
                        yoyo: true,
                        repeat: 1
                    });

                    showToast('Note saved successfully!');
                } else {
                    // Updating shared note
                    const sharedNoteIndex = sharedNotes.findIndex(n => n.id === currentNoteId);

                    if (sharedNoteIndex !== -1) {
                        sharedNotes[sharedNoteIndex].title = title;
                        sharedNotes[sharedNoteIndex].content = content;
                        sharedNotes[sharedNoteIndex].updatedAt = new Date().toISOString();

                        // Add current user as collaborator if not already there
                        if (!sharedNotes[sharedNoteIndex].collaborators.includes(currentUser) &&
                            currentUser !== sharedNotes[sharedNoteIndex].owner) {
                            sharedNotes[sharedNoteIndex].collaborators.push(currentUser);
                        }

                        saveSharedNotes();
                        renderSharedNotes();

                        // Animation
                        gsap.to('#save-note-btn', {
                            scale: 1.1,
                            duration: 0.2,
                            yoyo: true,
                            repeat: 1
                        });

                        showToast('Shared note updated successfully!');
                    }
                }
            };

            // Delete current note with animation
            const deleteNote = () => {
                if (!currentNoteId) return;

                // Check if we're deleting a personal note or a shared note
                const noteIndex = notes.findIndex(n => n.id === currentNoteId);

                if (noteIndex !== -1) {
                    // Deleting personal note
                    const noteTitle = notes[noteIndex].title || 'Untitled Note';
                    notes.splice(noteIndex, 1);
                    saveNotes();

                    // Animation
                    gsap.to('.note-item.active', {
                        opacity: 0,
                        x: -50,
                        duration: 0.3,
                        onComplete: () => {
                            renderNotesList();

                            // Clear editor
                            currentNoteId = null;
                            noteTitleEl.value = '';
                            noteContentEl.value = '';
                            collaboratorsEl.classList.add('hidden');
                            shareLinkEl.value = '';
                            toggleEditorView();

                            showToast(`"${noteTitle}" deleted successfully!`);
                        }
                    });
                } else {
                    // Remove shared note from our list
                    const sharedNoteIndex = sharedNotes.findIndex(n => n.id === currentNoteId);

                    if (sharedNoteIndex !== -1) {
                        const noteTitle = sharedNotes[sharedNoteIndex].title || 'Untitled Note';
                        sharedNotes.splice(sharedNoteIndex, 1);
                        saveSharedNotes();

                        // Animation
                        gsap.to('#editor-container', {
                            opacity: 0,
                            y: 20,
                            duration: 0.3,
                            onComplete: () => {
                                renderSharedNotes();

                                // Clear editor
                                currentNoteId = null;
                                noteTitleEl.value = '';
                                noteContentEl.value = '';
                                collaboratorsEl.classList.add('hidden');
                                shareLinkEl.value = '';
                                toggleEditorView();

                                showToast(`Shared note "${noteTitle}" removed successfully!`);
                            }
                        });
                    }
                }
            };

            // Share current note with animation
            const shareNote = () => {
                if (!currentNoteId) return;

                const noteIndex = notes.findIndex(n => n.id === currentNoteId);

                if (noteIndex !== -1) {
                    notes[noteIndex].shared = true;
                    notes[noteIndex].owner = currentUser;
                    saveNotes();

                    const shareLink = `${window.location.origin}${window.location.pathname}?share=${notes[noteIndex].id}`;
                    shareLinkEl.value = shareLink;
                    modalShareLinkEl.value = shareLink;

                    // Show sharing modal with animation
                    document.getElementById('share-modal').classList.add('show');

                    // Animation
                    gsap.from('.modal', {
                        opacity: 0,
                        y: -30,
                        duration: 0.4
                    });

                    // Update note in the list
                    renderNotesList();
                }
            };

            // Save notes to localStorage
            const saveNotes = () => {
                localStorage.setItem('notes', JSON.stringify(notes));
            };

            // Save shared notes to localStorage
            const saveSharedNotes = () => {
                localStorage.setItem('sharedNotes', JSON.stringify(sharedNotes));
            };

            // Check for shared note in URL
            const checkForSharedNote = () => {
                const urlParams = new URLSearchParams(window.location.search);
                const shareId = urlParams.get('share');

                if (shareId) {
                    // Show loading indicator
                    const loadingIndicator = document.createElement('div');
                    loadingIndicator.className = 'loading';
                    loadingIndicator.innerHTML = '<div></div><div></div><div></div><div></div>';
                    document.body.appendChild(loadingIndicator);

                    // Mock API call to fetch shared note data
                    setTimeout(() => {
                        // Simulate finding the shared note data
                        const personalNote = notes.find(n => n.id === shareId && n.shared);

                        if (personalNote) {
                            // Check if we already have this note in our shared notes
                            const existingSharedNote = sharedNotes.find(n => n.id === shareId);

                            if (!existingSharedNote) {
                                // Add to our shared notes
                                const sharedNote = JSON.parse(JSON.stringify(personalNote));
                                if (!sharedNote.collaborators) {
                                    sharedNote.collaborators = [];
                                }
                                if (!sharedNote.collaborators.includes(currentUser) && currentUser !== sharedNote.owner) {
                                    sharedNote.collaborators.push(currentUser);
                                }
                                sharedNotes.push(sharedNote);
                                saveSharedNotes();
                                renderSharedNotes();
                                loadSharedNote(shareId);

                                // Animation
                                gsap.from('#editor-container', {
                                    opacity: 0,
                                    y: 20,
                                    duration: 0.5
                                });

                                showToast('Shared note opened successfully!');
                            } else {
                                loadSharedNote(shareId);
                            }
                        }

                        // Remove loading indicator
                        document.body.removeChild(loadingIndicator);
                    }, 1000);
                }
            };

            // Event Listeners
            document.getElementById('add-note-btn').addEventListener('click', createNewNote);
            document.getElementById('save-note-btn').addEventListener('click', saveNote);
            document.getElementById('delete-note-btn').addEventListener('click', deleteNote);
            document.getElementById('share-note-btn').addEventListener('click', shareNote);

            // Auto-save when typing (debounced)
            let autoSaveTimer;
            const autoSave = () => {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(() => {
                    if (currentNoteId && (noteTitleEl.value || noteContentEl.value)) {
                        saveNote();
                    }
                }, 2000);
            };

            noteTitleEl.addEventListener('input', autoSave);
            noteContentEl.addEventListener('input', autoSave);

            // Name change modal
            document.getElementById('change-name-btn').addEventListener('click', () => {
                document.getElementById('name-input').value = currentUser;
                document.getElementById('name-modal').classList.add('show');

                // Animation
                gsap.from('.modal', {
                    opacity: 0,
                    y: -30,
                    duration: 0.4
                });
            });

            document.getElementById('cancel-name-btn').addEventListener('click', () => {
                document.getElementById('name-modal').classList.remove('show');
            });

            document.getElementById('save-name-btn').addEventListener('click', () => {
                const newName = document.getElementById('name-input').value.trim();
                if (newName) {
                    currentUser = newName;
                    updateUserName();
                    document.getElementById('name-modal').classList.remove('show');
                    showToast('Name updated successfully!');
                }
            });

            // Share modal
            document.getElementById('close-share-modal-btn').addEventListener('click', () => {
                document.getElementById('share-modal').classList.remove('show');
            });

            document.getElementById('copy-link-btn').addEventListener('click', () => {
                modalShareLinkEl.select();
                document.execCommand('copy');
                const btn = document.getElementById('copy-link-btn');
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-copy"></i> Copy Link';
                }, 2000);

                showToast('Link copied to clipboard!');
            });

            // Close modals when clicking outside
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + S to save
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveNote();
                }

                // Ctrl/Cmd + N to create new note
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    createNewNote();
                }

                // Escape to close modals
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay.show').forEach(modal => {
                        modal.classList.remove('show');
                    });
                }
            });

            // Initialize with animations
            gsap.from('header', {
                opacity: 0,
                y: -20,
                duration: 0.5
            });

            gsap.from('.panel', {
                opacity: 0,
                y: 20,
                stagger: 0.2,
                duration: 0.5,
                delay: 0.3
            });

            // Initialize application
            renderNotesList();
            renderSharedNotes();
            checkForSharedNote();
            toggleEditorView();
        });
    </script>
</body>

</html>
